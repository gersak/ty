{% extends "base.html" %}

{% block title %}Calendar & Date Components - Ty Components Demo{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Page Header -->
    <div class="text-center mb-16">
        <h1 class="text-4xl md:text-5xl font-bold mb-6">
            <span class="text-gradient-primary">📅 Calendar</span>
            <span class="ty-text-primary-strong"> & Date Components</span>
        </h1>
        <p class="text-xl ty-text-neutral-mild max-w-3xl mx-auto">
            Interactive calendar components with HTMX integration for dynamic event loading and server-side interactions.
        </p>
    </div>



    <!-- Calendar Components Demo -->
    <div class="mb-20">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold ty-text-primary-strong mb-4">
                📊 Event Calendar Display
            </h2>
            <p class="text-lg ty-text-neutral-mild">
                Interactive calendar for events, navigation, and display-only interactions
            </p>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
            
            <!-- Example 1: Basic Event Calendar -->
            <div class="glass-card">
                <div class="flex items-center mb-6">
                    <div class="feature-icon ty-bg-primary-soft mr-4">
                        <ty-icon name="calendar-days" class="ty-text-primary-strong"></ty-icon>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold ty-text-primary-strong">Basic Event Calendar</h3>
                        <p class="ty-text-neutral-mild">Display calendar with navigation and server events</p>
                    </div>
                </div>
                
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Calendar Component -->
                    <div class="lg:flex-1 ty-elevated rounded-xl p-6 max-w-4xl">
                        <ty-calendar id="event-calendar"
                                    show-navigation="true"
                                    size="lg"
                                    hx-get="/api/calendar/events"
                                    hx-trigger="navigate"
                                    hx-target="#event-list"
                                    hx-vals="js:{month: event.detail.month, year: event.detail.year}"
                                    hx-indicator="#events-loading">
                        </ty-calendar>
                    </div>
                    
                    <!-- Event List -->
                    <div class="lg:w-80 lg:flex-shrink-0">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-semibold ty-text-neutral-strong">
                                <span id="events-month-header">Events This Month</span>
                            </h4>
                            <div class="htmx-indicator" id="events-loading">
                                <div class="spinner ty-text-primary"></div>
                            </div>
                        </div>
                        <div id="event-list" class="space-y-3">
                            {% include "partials/event_list.html" %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Interactive Calendar Example -->
            <div class="glass-card">
                <div class="flex items-center mb-6">
                    <div class="feature-icon ty-bg-success-soft mr-4">
                        <ty-icon name="calendar-check" class="ty-text-success-strong"></ty-icon>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold ty-text-success-strong">Interactive Calendar</h3>
                        <p class="ty-text-neutral-mild">Date selection with server validation and events</p>
                    </div>
                </div>
                
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Calendar Component with Date Selection -->
                    <div class="lg:flex-1 flex justify-center">
                        <div class="ty-elevated rounded-xl p-6 w-full max-w-md">
                        <ty-calendar id="interactive-calendar"
                                    show-navigation="true"
                                    size="md"
                                    hx-trigger="change"
                                    hx-post="/api/calendar/date-select"
                                    hx-target="#interaction-feedback"
                                    hx-vals="js:{month: event.detail.month, year: event.detail.year, day: event.detail.day}"
                                    hx-indicator="#interaction-loading">
                        </ty-calendar>
                        </div>
                    </div>
                    
                    <!-- Interaction Feedback -->
                    <div class="lg:w-80 lg:flex-shrink-0">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-semibold ty-text-neutral-strong">Server Interaction</h4>
                            <div class="htmx-indicator" id="interaction-loading">
                                <div class="spinner ty-text-success"></div>
                            </div>
                        </div>
                        <div id="interaction-feedback" class="space-y-3 min-h-24">
                            <div class="ty-bg-info-soft rounded-lg p-4">
                                <p class="text-sm ty-text-info-mild">
                                    🎯 Navigate months or select dates to see server responses
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
</div>

<script>
// 🔍 COMPREHENSIVE DEBUG SETUP
console.group('🎯 Calendar Page Debug Initialization');
console.log('✅ Calendar page loaded - ready for step-by-step examples');
console.log('🔧 HTMX version:', typeof htmx !== 'undefined' ? htmx.version : 'NOT LOADED');
console.log('🎨 Ty components:', typeof ty !== 'undefined' ? 'LOADED' : 'NOT LOADED');
console.log('🌐 Location:', window.location.href);
console.groupEnd();

// 🚨 Global Error Monitoring
window.addEventListener('error', function(event) {
    console.error('💥 GLOBAL ERROR:', {
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        error: event.error
    });
});

// 🚨 Unhandled Promise Rejections
window.addEventListener('unhandledrejection', function(event) {
    console.error('💥 UNHANDLED PROMISE REJECTION:', event.reason);
});

// 🎯 HTMX Parameter Functions for ty-calendar



// 🔍 Calendar event debugging and navigation handling
document.addEventListener('navigate', function(event) {
    if (event.target.matches('ty-calendar')) {
        console.log('🚀 Calendar navigate event (native from ty-calendar):', event.detail);
        console.log('   - Month:', event.detail.month);
        console.log('   - Year:', event.detail.year);  
        console.log('   - Action:', event.detail.action);
        console.log('   - Source:', event.detail.source);
        console.log('   - Bubbles:', event.bubbles);
        console.log('   - Composed:', event.composed);
        console.log('   - Target:', event.target.id);
        console.log('   - HTMX should trigger on this event!');
        
        
        // Store navigation data and update header for basic event calendar
        if (event.target.id === 'event-calendar') {
            lastNavigationData = {
                year: event.detail.year,
                month: event.detail.month
            };
            console.log('📾 Stored navigation data for basic calendar:', lastNavigationData);
            
            // Update the events header with month name
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            const headerElement = document.getElementById('events-month-header');
            if (headerElement) {
                const monthName = monthNames[event.detail.month - 1];
                headerElement.textContent = `${monthName} ${event.detail.year} Events`;
            }
        }
    }
});

document.addEventListener('change', function(event) {
    if (event.target.matches('ty-calendar')) {
        if (event.detail.action === 'select') {
            console.log('   - Selected date:', event.detail.year + '-' + 
                       (event.detail.month < 10 ? '0' : '') + event.detail.month + '-' +
                       (event.detail.day < 10 ? '0' : '') + event.detail.day);
        }
        console.log('   - Target:', event.target.id);
        console.log('   - HTMX should trigger on this event!');
        
        }
});

// Initialize header with current month when page loads
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
    ];
    const headerElement = document.getElementById('events-month-header');
    if (headerElement) {
        const monthName = monthNames[now.getMonth()];
        headerElement.textContent = `${monthName} ${now.getFullYear()} Events`;
    }
    
    // 🎯 ENHANCED: Add day content function to event calendar
    const eventCalendar = document.getElementById('event-calendar');
    if (eventCalendar) {
        console.log('🎨 Setting up day content function for event calendar');
        
        // Custom CSS for day badges
        eventCalendar.customCSS = `
            .simple-day {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2px;
                width: 100%;
                height: 100%;
            }
            
            .day-number {
                font-size: inherit;
                line-height: 1;
            }
            
            .day-badge-container {
                min-height: 12px;
                display: flex;
                justify-content: center;
            }
            
            .event-badge {
                font-size: 9px;
                padding: 1px 4px;
                border-radius: 6px;
                color: white;
                background: var(--ty-color-primary);
                font-weight: 500;
                white-space: nowrap;
            }
        `;
        
        // Day content function with HTMX loading
        eventCalendar.dayContentFn = function(dayContext) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'simple-day';
            
            // Create day number
            const dayNumber = document.createElement('span');
            dayNumber.className = 'day-number';
            dayNumber.textContent = dayContext['day-in-month'];
            
            // Create badge container with HTMX
            const badgeContainer = document.createElement('div');
            badgeContainer.className = 'day-badge-container';
            badgeContainer.setAttribute('hx-get', `/api/day-events/${dayContext['year']}-${dayContext['month']}-${dayContext['day-in-month']})`);
            badgeContainer.setAttribute('hx-trigger', 'load');
            badgeContainer.setAttribute('hx-swap', 'innerHTML');
            
            // Append elements
            dayDiv.appendChild(dayNumber);
            dayDiv.appendChild(badgeContainer);
            
            return dayDiv;
        };
        
        console.log('✅ Day content function configured with HTMX badges');
    }
});

</script>
{% endblock %}
