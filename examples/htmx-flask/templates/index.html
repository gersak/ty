{% extends "base.html" %}

{% block title %}Home - Beautiful Ty Components Demo{% endblock %}

{% block content %}
<!-- Hero Section with Modern Design -->
<div class="relative overflow-hidden bg-gradient-hero">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23f0f0f0" fill-opacity="0.1"%3E%3Ccircle cx="7" cy="7" r="1"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-20"></div>
    
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-20 pb-24">
        <div class="text-center animate-fade-in">
            <h1 class="text-5xl md:text-6xl font-bold mb-8">
                <span class="text-gradient-primary">Beautiful</span>
                <span class="ty-text-primary-strong"> Web Components</span>
            </h1>
            <p class="text-xl md:text-2xl ty-text-neutral-mild max-w-3xl mx-auto mb-12 leading-relaxed">
                Experience the perfect fusion of 
                <span class="ty-text-primary-strong font-semibold">Ty Components</span>,
                <span class="ty-text-success-strong font-semibold">HTMX</span>, and 
                <span class="ty-text-warning-strong font-semibold">Tailwind CSS</span>
                creating dynamic, server-rendered applications that feel magical.
            </p>
            
            <div class="flex flex-col sm:flex-row justify-center gap-6 animate-slide-up">
                <ty-button flavor="primary" size="lg" 
                           class="transform hover:scale-[1.02] transition-transform duration-200 shadow-lg"
                           onclick="window.location.href='{{ url_for('forms') }}'">
                    <ty-icon name="zap" class="mr-1"></ty-icon>
                    Explore Interactive Forms
                </ty-button>
                <ty-button flavor="secondary" size="lg"
                           class="transform hover:scale-[1.02] transition-transform duration-200"
                           onclick="window.location.href='{{ url_for('components') }}'">
                    <ty-icon name="layers" class="mr-1"></ty-icon>
                    View Components
                </ty-button>
            </div>
        </div>
    </div>
    
    <!-- Decorative Elements -->
    <div class="absolute top-20 left-10 w-72 h-72 rounded-full bg-gradient-to-r from-blue-400/20 to-purple-600/20 blur-3xl"></div>
    <div class="absolute bottom-20 right-10 w-80 h-80 rounded-full bg-gradient-to-r from-green-400/20 to-blue-600/20 blur-3xl"></div>
</div>

<!-- Interactive Features Grid -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
    <div class="text-center mb-16">
        <h2 class="text-4xl font-bold ty-text-primary-strong mb-6">
            Live Interactive Demos
        </h2>
        <p class="text-xl ty-text-neutral-mild max-w-2xl mx-auto">
            See real-world patterns in action. Every interaction is powered by server-side logic.
        </p>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-16">
        <!-- Interactive User Search -->
        <div class="glass-card group hover:scale-[1.02] transition-all duration-300 animate-slide-up">
            <div class="flex items-center mb-6">
                <div>
                    <h3 class="text-2xl font-bold ty-text-primary-strong mb-2">
                        üîç Smart User Search
                    </h3>
                    <p class="ty-text-neutral-mild">
                        Live server-side filtering with beautiful results
                    </p>
                </div>
            </div>
            
            <div class="space-y-6">
                <div class="relative">
                    <ty-input
                        placeholder="Search users by name or email..."
                        class="w-full text-lg"
                        hx-get="/api/users/search"
                        hx-target="#user-results"
                        hx-trigger="input changed delay:300ms, focus"
                        hx-indicator="#search-loading"
                        autocomplete="off"
                        name="q">
                    </ty-input>
                    <div id="search-loading" class="absolute right-4 top-1/2 transform -translate-y-1/2 htmx-indicator">
                        <div class="spinner ty-text-primary"></div>
                    </div>
                </div>
                
                <div id="user-results" class="min-h-32 ty-bg-neutral-soft rounded-xl p-6 transition-all duration-300">
                    {% include 'partials/user_search_results.html' %}
                </div>
            </div>
        </div>

        <!-- Dynamic Task Management -->
        <div class="glass-card group hover:scale-[1.02] transition-all duration-300 animate-slide-up">
            <div class="flex items-center mb-6">
                <div>
                    <h3 class="text-2xl font-bold ty-text-success-strong mb-2">
                        üìã Task Dashboard
                    </h3>
                    <p class="ty-text-neutral-mild">
                        Real-time filtering and status management
                    </p>
                </div>
            </div>
            
            <div class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="form-label">Status Filter</label>
                        <ty-dropdown id="status-filter" 
                                     name="status"
                                     placeholder="All Statuses"
                                     class="w-full"
                                     hx-get="/api/tasks/filter"
                                     hx-target="#task-results"
                                     hx-include="#priority-filter"
                                     hx-trigger="change"
                                     hx-indicator="#task-loading">
                            <ty-option value="">All Statuses</ty-option>
                            <ty-option value="pending">‚è≥ Pending</ty-option>
                            <ty-option value="in-progress">üöÄ In Progress</ty-option>
                            <ty-option value="completed">‚úÖ Completed</ty-option>
                        </ty-dropdown>
                    </div>
                    
                    <div class="space-y-2">
                        <label class="form-label">Priority Filter</label>
                        <ty-dropdown id="priority-filter"
                                     name="priority"
                                     placeholder="All Priorities"
                                     class="w-full"
                                     hx-get="/api/tasks/filter"
                                     hx-target="#task-results"
                                     hx-include="#status-filter"
                                     hx-trigger="change"
                                     hx-indicator="#task-loading">
                            <ty-option value="">All Priorities</ty-option>
                            <ty-option value="low">üîµ Low</ty-option>
                            <ty-option value="medium">üü° Medium</ty-option>
                            <ty-option value="high">üü† High</ty-option>
                            <ty-option value="critical">üî¥ Critical</ty-option>
                        </ty-dropdown>
                    </div>
                </div>
                
                <div class="relative">
                    <div id="task-loading" class="absolute top-2 right-2 htmx-indicator">
                        <div class="spinner ty-text-primary"></div>
                    </div>
                    <div id="task-results" class="space-y-3">
                        {% include 'partials/task_list.html' %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Event Scheduler -->
        <div class="glass-card group hover:scale-[1.02] transition-all duration-300 animate-slide-up">
            <div class="flex items-center mb-6">
                <div class="feature-icon ty-bg-warning-soft mr-4">
                    <ty-icon name="calendar-plus" class="ty-text-warning-strong"></ty-icon>
                </div>
                <div>
                    <h3 class="text-2xl font-bold ty-text-warning-strong mb-2">
                        üìÖ Event Scheduler
                    </h3>
                    <p class="ty-text-neutral-mild">
                        Interactive calendar with real-time event management
                    </p>
                </div>
            </div>
            
            <div class="space-y-6">
                <!-- Calendar with Navigation -->
                <div class="ty-elevated rounded-xl p-4">
                    <ty-calendar 
                        id="event-calendar"
                        name="event_date"
                        class="w-full"
                        show-navigation="true">
                    </ty-calendar>
                </div>
                
                <!-- Quick Event Creation -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <h4 class="font-semibold ty-text-neutral-strong">Quick Event</h4>
                        <div id="calendar-loading" class="htmx-indicator">
                            <div class="spinner ty-text-primary"></div>
                        </div>
                    </div>
                    
                    <form id="event-form" class="flex gap-3 items-center" 
                          hx-post="/api/calendar/create-event"
                          hx-target="#calendar-events"
                          hx-swap="innerHTML">
                        <input type="hidden" name="event_date" id="selected-date-input" value="">
                        <ty-input name="event_title" 
                                  placeholder="Enter event title..." 
                                  class="flex-1"
                                  required>
                        </ty-input>
                        <ty-dropdown name="event_type" class="w-32">
                            <ty-option value="meeting">ü§ù Meeting</ty-option>
                            <ty-option value="deadline">üìã Deadline</ty-option>
                            <ty-option value="personal">üë§ Personal</ty-option>
                            <ty-option value="reminder">‚è∞ Reminder</ty-option>
                        </ty-dropdown>
                        <ty-button type="submit" flavor="primary" size="lg">
                            <ty-icon name="plus"></ty-icon>
                            Add
                        </ty-button>
                    </form>
                    
                    <div id="date-selection-status" class="text-sm ty-text-neutral-mild">
                        üìÖ Click on a date above to start scheduling events
                    </div>
                </div>
                
                <!-- Events Display -->
                <div class="space-y-3">
                    <h4 class="font-semibold ty-text-neutral-strong">Scheduled Events</h4>
                    <div id="calendar-events" class="space-y-2 max-h-48 overflow-y-auto ty-bg-neutral-soft rounded-lg p-4">
                        {% include 'partials/event_list.html' %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Dynamic Modals -->
        <div class="glass-card group hover:scale-[1.02] transition-all duration-300 animate-slide-up">
            <div class="flex items-center mb-6">
                <div class="feature-icon ty-bg-info-soft mr-4">
                    <ty-icon name="window" class="ty-text-info-strong"></ty-icon>
                </div>
                <div>
                    <h3 class="text-2xl font-bold ty-text-info-strong mb-2">
                        üé≠ Dynamic Modals
                    </h3>
                    <p class="ty-text-neutral-mild">
                        Server-powered content loading in beautiful dialogs
                    </p>
                </div>
            </div>
            
            <div class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <ty-button flavor="primary" size="lg"
                               class="w-full"
                               hx-get="/api/modal/content/user-profile?user_id=1"
                               hx-target="#modal-content"
                               onclick="document.getElementById('demo-modal').show()">
                        <ty-icon name="user" class="mr-1"></ty-icon>
                        User Profile
                    </ty-button>
                    
                    <ty-button flavor="secondary" size="lg"
                               class="w-full"
                               hx-get="/api/modal/content/task-details?task_id=1"
                               hx-target="#modal-content"
                               onclick="document.getElementById('demo-modal').show()">
                        <ty-icon name="clipboard" class="mr-1"></ty-icon>
                        Task Details
                    </ty-button>
                </div>
                
                <div class="ty-bg-neutral-soft rounded-xl p-6 text-center">
                    <ty-icon name="sparkles" class="w-12 h-12 mx-auto mb-3 ty-text-info-mild"></ty-icon>
                    <p class="ty-text-neutral-mild">
                        Click the buttons above to see dynamic content loading in action!
                    </p>
                </div>
                
                <ty-modal id="demo-modal">
                    <div id="modal-content">
                        <div class="text-center">
                            <div class="spinner ty-text-primary mb-4"></div>
                            <p class="ty-text-neutral-mild">Loading amazing content...</p>
                        </div>
                    </div>
                </ty-modal>
            </div>
        </div>
    </div>

    <!-- Technology Showcase -->
    <div class="ty-elevated rounded-2xl p-12 mb-16 bg-gradient-primary">
        <div class="text-center mb-12">
            <h2 class="text-4xl font-bold ty-text-primary-strong mb-6">
                Powered by Modern Technologies
            </h2>
            <p class="text-xl ty-text-neutral-mild max-w-3xl mx-auto">
                See how beautifully these technologies work together to create amazing user experiences.
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="text-center group">
                <div class="feature-icon ty-bg-primary-soft group-hover:scale-[1.05] transition-transform duration-300">
                    <ty-icon name="zap" class="ty-text-primary-strong"></ty-icon>
                </div>
                <h3 class="text-xl font-bold ty-text-primary-strong mb-3">Real-time Validation</h3>
                <p class="ty-text-neutral-mild">
                    Server-side form validation with instant feedback and beautiful error states.
                </p>
            </div>
            
            <div class="text-center group">
                <div class="feature-icon ty-bg-success-soft group-hover:scale-[1.05] transition-transform duration-300">
                    <ty-icon name="search" class="ty-text-success-strong"></ty-icon>
                </div>
                <h3 class="text-xl font-bold ty-text-success-strong mb-3">Dynamic Search</h3>
                <p class="ty-text-neutral-mild">
                    Live search with server-side filtering, debouncing, and beautiful result presentation.
                </p>
            </div>
            
            <div class="text-center group">
                <div class="feature-icon ty-bg-warning-soft group-hover:scale-[1.05] transition-transform duration-300">
                    <ty-icon name="calendar-plus" class="ty-text-warning-strong"></ty-icon>
                </div>
                <h3 class="text-xl font-bold ty-text-warning-strong mb-3">Event Scheduler</h3>
                <p class="ty-text-neutral-mild">
                    Interactive calendar with real-time event creation, management, and server-side persistence.
                </p>
            </div>
        </div>
    </div>

    <!-- Call to Action -->
    <div class="text-center">
        <div class="inline-block p-8 glass-card">
            <h2 class="text-3xl font-bold ty-text-primary-strong mb-4">
                Ready to Build Something Amazing?
            </h2>
            <p class="text-lg ty-text-neutral-mild mb-6">
                Explore all the features and see the source code.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <ty-button flavor="primary" size="lg"
                           onclick="window.location.href='{{ url_for('forms') }}'">
                    <ty-icon name="play" class="mr-1"></ty-icon>
                    Try Interactive Forms
                </ty-button>
                <ty-button flavor="outline" size="lg"
                           onclick="window.open('https://github.com/yourusername/ty', '_blank')">
                    <ty-icon name="github" class="mr-1"></ty-icon>
                    View Source Code
                </ty-button>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced JavaScript -->
<script>
// Enhanced calendar event handling with ty-calendar
document.body.addEventListener('change', function(event) {
    // Only handle calendar change events
    if (event.target.id !== 'event-calendar') return;
    
    console.log('üìÖ Calendar change event received:', event.detail);
    
    const { month, year, day, action, source } = event.detail;
    
    if (action === 'select' && day) {
        console.log(`‚úÖ Date selected: ${year}-${month}-${day}`);
        
        // Format the date as ISO string (YYYY-MM-DD)
        const dateStr = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        
        // Update the hidden form field
        const hiddenInput = document.getElementById('selected-date-input');
        if (hiddenInput) {
            hiddenInput.value = dateStr;
            console.log(`üìù Updated hidden input with: ${dateStr}`);
        }
        
        // Update the status display
        updateDateSelectionStatus(year, month, day);
        
        // Add visual feedback to calendar
        const calendar = event.target;
        calendar.style.transform = 'scale(0.98)';
        setTimeout(() => {
            calendar.style.transform = 'scale(1)';
        }, 150);
        
        // Trigger the calendar select-date endpoint to load events
        htmx.ajax('POST', '/api/calendar/select-date', {
            values: { 
                event_date: dateStr,
                year: year,
                month: month,
                day: day
            },
            target: '#calendar-events',
            swap: 'innerHTML'
        });
        
    } else if (action === 'navigate') {
        console.log(`üß≠ Navigation: ${year}-${month}`);
        // Clear selection when navigating to different month
        const hiddenInput = document.getElementById('selected-date-input');
        if (hiddenInput) {
            hiddenInput.value = '';
        }
        updateDateSelectionStatus(null, null, null);
    }
});

function updateDateSelectionStatus(year, month, day) {
    const statusDiv = document.getElementById('date-selection-status');
    if (!statusDiv) return;
    
    if (year && month && day) {
        const date = new Date(year, month - 1, day);
        const formattedDate = new Intl.DateTimeFormat('en-US', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        }).format(date);
        
        statusDiv.innerHTML = `‚úÖ Selected: <strong>${formattedDate}</strong> - Ready to add events!`;
        statusDiv.className = 'text-sm ty-text-success-strong';
        
        // Show success toast
        showDateSelectedToast(formattedDate);
    } else {
        statusDiv.innerHTML = 'üìÖ Click on a date above to start scheduling events';
        statusDiv.className = 'text-sm ty-text-neutral-mild';
    }
}

function showDateSelectedToast(dateStr) {
    // Create a temporary toast notification
    const toast = document.createElement('div');
    toast.className = 'fixed top-4 right-4 ty-bg-success rounded-lg p-3 text-white shadow-lg z-50 animate-slide-in-right';
    toast.innerHTML = `
        <div class="flex items-center space-x-2">
            <ty-icon name="calendar-check" class="text-white"></ty-icon>
            <span class="font-medium">Selected: ${dateStr}</span>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    // Remove after 3 seconds
    setTimeout(() => {
        toast.style.transform = 'translateX(100%)';
        toast.style.opacity = '0';
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }, 3000);
}

// Form submission enhancement
document.body.addEventListener('htmx:beforeRequest', function(event) {
    if (event.target.matches('form[hx-post*="/api/calendar/create-event"]')) {
        // Check if a date is selected
        const hiddenInput = document.getElementById('selected-date-input');
        if (!hiddenInput || !hiddenInput.value) {
            event.preventDefault();
            
            // Show error feedback
            const statusDiv = document.getElementById('date-selection-status');
            if (statusDiv) {
                statusDiv.innerHTML = '‚ùå Please select a date from the calendar first!';
                statusDiv.className = 'text-sm ty-text-danger-strong';
                
                // Reset after 3 seconds
                setTimeout(() => {
                    statusDiv.innerHTML = 'üìÖ Click on a date above to start scheduling events';
                    statusDiv.className = 'text-sm ty-text-neutral-mild';
                }, 3000);
            }
            
            return false;
        }
        
        console.log('üì§ Submitting event with date:', hiddenInput.value);
    }
});

document.body.addEventListener('htmx:afterRequest', function(event) {
    if (event.target.matches('form[hx-post*="/api/calendar/create-event"]')) {
        if (event.detail.xhr.status === 200) {
            // Clear the form after successful submission
            const form = event.target;
            const titleInput = form.querySelector('ty-input[name="event_title"]');
            if (titleInput) {
                titleInput.value = '';
                titleInput.setAttribute('value', '');
            }
            
            // Reset dropdown
            const dropdown = form.querySelector('ty-dropdown[name="event_type"]');
            if (dropdown) {
                dropdown.value = 'meeting';
            }
            
            // Show success feedback
            if (titleInput) {
                titleInput.style.boxShadow = '0 0 0 2px var(--ty-color-success)';
                setTimeout(() => {
                    titleInput.style.boxShadow = '';
                }, 1000);
            }
            
            console.log('‚úÖ Event created successfully');
        } else {
            console.error('‚ùå Failed to create event:', event.detail.xhr.status);
        }
    }
});

// Calendar component initialization check
document.addEventListener('DOMContentLoaded', function() {
    console.log('üîç Checking event calendar setup...');
    
    const calendar = document.getElementById('event-calendar');
    if (calendar) {
        console.log('‚úÖ Event calendar found');
        
        // Check if the calendar is properly initialized
        setTimeout(() => {
            const hasNavigation = calendar.querySelector('ty-calendar-navigation');
            const hasMonth = calendar.querySelector('ty-calendar-month');
            
            console.log('üß≠ Navigation component:', hasNavigation ? '‚úÖ' : '‚ùå');
            console.log('üìÖ Month component:', hasMonth ? '‚úÖ' : '‚ùå');
            
            if (!hasNavigation || !hasMonth) {
                console.warn('‚ö†Ô∏è Calendar components not fully initialized');
            }
        }, 1000);
    } else {
        console.error('‚ùå Event calendar element not found!');
    }
});

// Add loading states and animations
document.body.addEventListener('htmx:beforeRequest', function(event) {
    const target = event.detail.target;
    if (target) {
        target.style.opacity = '0.8';
        target.style.transform = 'scale(0.99)';
    }
});

document.body.addEventListener('htmx:afterRequest', function(event) {
    const target = event.detail.target;
    if (target) {
        target.style.opacity = '1';
        target.style.transform = 'scale(1)';
        target.classList.add('animate-fade-in');
    }
});

// Theme toggle enhancement
function toggleTheme() {
    document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
}

// Initialize theme from localStorage
document.addEventListener('DOMContentLoaded', function() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    if (savedTheme === 'dark') {
        document.documentElement.classList.add('dark');
    }
});
</script>
{% endblock %}
